@model Proyecto_FinalProgra1.Models.Order
@{
    ViewData["Title"] = "Checkout";
}

<h2 class="text-primary">Finalizar Pedido</h2>

<form asp-action="Checkout" method="post">
    <div class="mb-3">
        <label asp-for="Name" class="form-label"></label>
        <input asp-for="Name" class="form-control" />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Email" class="form-label"></label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="MobileNumber" class="form-label"></label>
        <input asp-for="MobileNumber" class="form-control" />
        <span asp-validation-for="MobileNumber" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Address" class="form-label"></label>
        <textarea asp-for="Address" class="form-control"></textarea>
        <span asp-validation-for="Address" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="PaymentMethod" class="form-label"></label>
        <select asp-for="PaymentMethod" class="form-select">
            <option value="">-- Selecciona método de pago --</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Tarjeta">Tarjeta</option>
            <option value="Yape/Plin">Yape/Plin</option>
        </select>
        <span asp-validation-for="PaymentMethod" class="text-danger"></span>
<<<<<<< HEAD
=======

        <!-- Botón de PayPal oculto por defecto -->
        <div id="paypal-button-container" style="display:none; margin-top: 20px;"></div>
        <input type="hidden" id="paypalApproved" name="paypalApproved" value="false" />
>>>>>>> 681a78d46f9de03667c9166520e17b06558be08d
    </div>

    <button type="submit" class="btn btn-success">Confirmar Pedido</button>
    <a asp-controller="ShoppingCart" asp-action="Index" class="btn btn-secondary">Volver al carrito</a>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
<<<<<<< HEAD
=======

    <!-- SDK de PayPal -->
    <script src="https://www.paypal.com/sdk/js?client-id=Aekq4pNgN-aA_N6X6rFEMzcGSrH9f9aoxBEiAp_t3RzA_OvwvMwT9OF8dokFBitPVv1utWRAAjBtRZSM&currency=USD"></script>

    <script>
        const paymentSelect = document.querySelector('[name="PaymentMethod"]');
        const paypalContainer = document.getElementById('paypal-button-container');
        const paypalApproved = document.getElementById('paypalApproved');
        const form = document.querySelector('form');

        function togglePayPalButton() {
            if (paymentSelect.value === 'Tarjeta') {
                paypalContainer.style.display = 'block';
            } else {
                paypalContainer.style.display = 'none';
                paypalApproved.value = 'false';
            }
        }

        paymentSelect.addEventListener('change', togglePayPalButton);
        togglePayPalButton();

        paypal.Buttons({
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '@ViewBag.Total' // Ej. "25.00"
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    alert('Pago exitoso por: ' + details.payer.name.given_name);
                    paypalApproved.value = "true";
                    form.submit();
                });
            }
        }).render('#paypal-button-container');
    </script>
>>>>>>> 681a78d46f9de03667c9166520e17b06558be08d
}
